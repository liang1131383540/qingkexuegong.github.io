<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0150)https://wvpn.qust.edu.cn/http/77726476706e69737468656265737421f2e74cd236257b44300d8db9d6562d/bpmx/platform/bpm/task/toStart.ht?taskId=2000000002354505 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta content="IE=EmulateIE11" http-equiv="X-UA-Compatible">


 <link rel="shortcut icon" href="https://wvpn.qust.edu.cn/http/77726476706e69737468656265737421f2e74cd236257b44300d8db9d6562d/bpmx/image/favicon.ico" type="image/x-icon">


	<meta name="renderer" content="webkit">
		<title>流程任务-[销假申请]执行</title>
		







<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="Referrer" content="always">

<link rel="stylesheet" type="text/css" href="./流程任务-[销假申请]执行_files/web.css">
<link rel="stylesheet" type="text/css" href="./流程任务-[销假申请]执行_files/ligerui-all.css">
<link rel="stylesheet" type="text/css" href="./流程任务-[销假申请]执行_files/zTreeStyle.css">

<script type="text/javascript" src="./流程任务-[销假申请]执行_files/zh_CN.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/zh_CN.js(1).下载"></script>

<script type="text/javascript" src="./流程任务-[销假申请]执行_files/dynamic.jsp"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/jquery.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/jquery.form.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/util.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/json2.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/form.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/jquery.ztree.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/base.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ligerComboBox.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/htDicCombo.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ligerMenuBar.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ligerMenu.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ligerTextBox.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ligerTip.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ligerTab.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ligerMessageBox.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ligerMsg.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ligerDrag.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ligerDialog.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ligerResizable.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/WdatePicker.js.下载"></script><link href="./流程任务-[销假申请]执行_files/WdatePicker.css" rel="stylesheet" type="text/css">
<link href="./流程任务-[销假申请]执行_files/jquery.qtip.css" rel="stylesheet">
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/jquery.qtip.js.下载"></script>
<script type="text/javascript" charset="utf-8" src="./流程任务-[销假申请]执行_files/ueditor_default.config.js.下载"></script>
<script type="text/javascript" charset="utf-8" src="./流程任务-[销假申请]执行_files/ueditor.all.min.js.下载"></script>
<script type="text/javascript" charset="utf-8" src="./流程任务-[销假申请]执行_files/zh-cn.js.下载"></script>
<script type="text/javascript" charset="utf-8" src="./流程任务-[销假申请]执行_files/picture.js.下载"></script>
<script type="text/javascript">vpn_eval((function(){

	$(function() {
		$("textarea.myeditor").each(function(num) {
			var ue =new baidu.editor.ui.Editor({minFrameHeight:300,initialFrameWidth:800,lang:'zh_cn'});
			ue.render(this);
		});
	});
	function getEditorData(obj){
		return obj.getContent();
	}


}
).toString().slice(12, -2),"");</script>

<script type="text/javascript" src="./流程任务-[销假申请]执行_files/SysDialog.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/rule.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/DialogUtil.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/CustomValid.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/SelectorInit.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/TablePermission.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/CustomForm.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/FlexUploadDialog.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/HtmlUploadDialog.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/AttachMent.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/SubtablePermission.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ReadOnlyQuery.js.下载"></script>



<link href="./流程任务-[销假申请]执行_files/jquery.fancybox.css" rel="stylesheet">
<link href="./流程任务-[销假申请]执行_files/pictureShow.css" rel="stylesheet">
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/jquery.fancybox.pack.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/PictureShowControl.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/PictureShowPlugin.js.下载"></script>

<script type="text/javascript" src="./流程任务-[销假申请]执行_files/CommonDialog.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/FormMath.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/FormDate.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/FormUtil.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/FormExcel.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ShowExeInfo.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/SysAuditLink.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/Cascadequery.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/ImageQtip.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/FormInit.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/RunAliasScript.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/CombinateDialogUtil.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/Share.js.下载"></script>
<script type="text/javascript" src="./流程任务-[销假申请]执行_files/qrcode.min.js.下载"></script>


		<script type="text/javascript" charset="utf-8" src="./流程任务-[销假申请]执行_files/ueditor_default.config.js.下载"></script>
<script type="text/javascript" charset="utf-8" src="./流程任务-[销假申请]执行_files/ueditor.all.min.js.下载"></script>
<script type="text/javascript" charset="utf-8" src="./流程任务-[销假申请]执行_files/zh-cn.js.下载"></script>
<script type="text/javascript" charset="utf-8" src="./流程任务-[销假申请]执行_files/picture.js.下载"></script>
<script type="text/javascript">vpn_eval((function(){

	$(function() {
		$("textarea.myeditor").each(function(num) {
			var ue =new baidu.editor.ui.Editor({minFrameHeight:300,initialFrameWidth:800,lang:'zh_cn'});
			ue.render(this);
		});
	});
	function getEditorData(obj){
		return obj.getContent();
	}


}
).toString().slice(12, -2),"");</script>

		<link rel="stylesheet" type="text/css" href="./流程任务-[销假申请]执行_files/task.css">
		<script type="text/javascript" src="./流程任务-[销假申请]执行_files/TaskAddSignWindow.js.下载"></script>
		<script type="text/javascript" src="./流程任务-[销假申请]执行_files/TaskBackWindow.js.下载"></script>
		<script type="text/javascript" src="./流程任务-[销假申请]执行_files/TaskImageUserDialog.js.下载"></script>
		<script type="text/javascript" src="./流程任务-[销假申请]执行_files/tabOperator.js.下载"></script>
		<script type="text/javascript" src="./流程任务-[销假申请]执行_files/BpmTaskExeAssignDialog.js.下载"></script>
		<script type="text/javascript" src="./流程任务-[销假申请]执行_files/BpmRetransmissionDialog.js.下载"></script>
		
		<script type="text/javascript">vpn_eval((function(){


		var taskId="2000000002354505";
		var nodeId = "UserTask4";
		var nodeName = "销假申请";
		var runId="2000000002262650";
		var isExtForm=false;
		var isEmptyForm=false;
		var isSignTask=false;
		var isHidePath=true;
		var isManage=0;
		var isNeedSubmitConfirm=false;
		var isHandChoolse=false;
		var bpmGangedSets=[];
		var tabid = $.getParameter("tabid");
		var form;
		var fromUrl = "";
		//操作类型
		//1.完成任务
		//2.保存数据
		var operatorType=1;

		//补签
		function showAddSignWindow(){
			TaskAddSignWindow({taskId:taskId,callback:function(sign){
				loadTaskSign();
			}});
		}

		//加载会签数据。
		function loadTaskSign(){
			$(".taskOpinion").load('/bpmx/platform/bpm/task/toSign.ht?taskId=2000000002354505');
		}
		//显示流程图
		function showTaskUserDlg(){
			TaskImageUserDialog({actInstId:2000000002262653});
		}
		//显示沟通意见。
		function showTaskCommunication(conf){
			var obj = {data:CustomForm.getData()};
			isTaskEnd(function(){
				if(!conf) conf={};
				//输入子页面
				var url=__ctx + "/platform/bpm/task/toStartCommunicate.ht?taskId=2000000002354505&setId=2000000000060441";

				/*KILLDIALOG*/
				DialogUtil.open({
					height:400,
					width:550,
					title:'沟通意见',
					url:url,
					isResize:true,
					//自定义参数
					obj:obj
				});
			})
		}
		//显示流转意见
		function showTaskTransTo(conf) {
			var obj = {data:CustomForm.getData()};
			isTaskEnd(function(){
				if(!conf) conf={};
				//输入子页面
				var url=__ctx + "/platform/bpm/task/toTransTo.ht?taskId=2000000002354505&curUserId=102031";

				url=url.getNewUrl();


				DialogUtil.open({
					height:500,
					width: 550,
					title : '显示流转意见',
					url: url,
					isResize: true,
					//自定义参数
					obj: obj,
					sucCall:function(rtn){
						if(rtn=="ok"){
							handJumpOrClose();
						}
					}
				});
			})
		}

		function handFormJson(json){}

		function submitForm(action,button){

			var ignoreRequired=false;
			if(button=="#btnSave" || button=="#btnReject" || button=="#btnRejectToStart"){
				ignoreRequired=true;
			}

			if($(button).hasClass("disabled"))return;
			if(isEmptyForm){
				$.ligerDialog.error("还没有设置表单!",'提示信息');
				return;
			}

			var frmWorkFlow=$('#frmWorkFlow');
			frmWorkFlow.attr("action",action);
			if(isExtForm){
				var rtn = true;
				if(button!="a.save"){
					rtn=form.valid()
				}
				if(!rtn) return;

				$(button).addClass("disabled");
				frmWorkFlow.ajaxForm({success:showResponse }); //terry add
				if(frmWorkFlow.handleFieldName){//url表单清除命名
					frmWorkFlow.handleFieldName();
				}
				if(frmWorkFlow.setData){
					frmWorkFlow.setData();
				}
				frmWorkFlow.submit();

			}else{
				var rtn=CustomForm.validate({ignoreRequired:ignoreRequired});
				if(!rtn){
					$.ligerDialog.warn("表单验证不成功,请检查表单是否正确填写!","提示信息");
					return;
				}

				if(button!="#btnSave" || button=="#btnReject" || button=="#btnRejectToStart" ){
					//子表必填检查(兼容新旧版本)
					rtn = SubtablePermission.subRequired();
					if(!rtn){
						$.ligerDialog.warn("请填写子表表单数据！","提示信息");
						return;
					}
				}

				var data=CustomForm.getData();
				//WebSign控件提交。 有控件时才提交   xcx
				/* if(WebSignPlugin.hasWebSignField){
					WebSignPlugin.submit();
				} */

				$(button).addClass("disabled");

				var uaName=navigator.userAgent.toLowerCase();
				/* if(uaName.indexOf("firefox")>=0||uaName.indexOf("chrome")>=0){  //异步处理
					Office控件提交。 有可以提交的文档
					if(OfficePlugin.submitNum>0){
						OfficePlugin.submit();             //火狐和谷歌 的文档提交包括了  业务提交代码部分（完成  OfficePlugin.submit()后面的回调 函数 有 业务提交代码），所以 后面就不用加上业务提交代码
					}else{   //没有可提交的文档时 直接做 业务提交代码
						data=CustomForm.getData();
						//设置表单数据
						$("#formData").val(data);
						FormSubmitUtil.submitFormAjax(frmWorkFlow,showResponse,handFormJson);
					}
				}else{   //同步处理
					Office控件提交。 有可以提交的文档
					if(OfficePlugin.submitNum>0){
						OfficePlugin.submit();
						//当提交问题 等于 提交数量的变量 时 表示所有文档 都提交了  然后做 业务相关的提交
						if(OfficePlugin.submitNum == OfficePlugin.submitNewNum){
							//获取自定义表单的数据
							data=CustomForm.getData();
							//设置表单数据
							$("#formData").val(data);

							FormSubmitUtil.submitFormAjax(frmWorkFlow,showResponse,handFormJson);
							OfficePlugin.submitNewNum = 0; //重置  提交数量的变量
						}else{
							$.ligerDialog.warn("提交失败,OFFICE控件没能正常使用，请重新安装 ！！！","提示");
						}
					}else{
						//获取自定义表单的数据
						data=CustomForm.getData();
						//设置表单数据
						$("#formData").val(data);
						FormSubmitUtil.submitFormAjax(frmWorkFlow,showResponse,handFormJson);
					}
				} */
				//获取自定义表单的数据
				data=CustomForm.getData();
				//设置表单数据
				$("#formData").val(data);
				FormSubmitUtil.submitFormAjax(frmWorkFlow,showResponse,handFormJson);
			}
		}

		function saveData(){
			var operatorObj=getByOperatorType();
			var button="#" +operatorObj.btnId;

			var rtn=beforeClick(operatorType);

			if( rtn==false){
				return;
			}
			if(isExtForm){//提交第三方表单时检查该表单的参数
				var frm=$('#frmWorkFlow');
				if(!frm.valid()) return ;
				if(frm.setData)frm.setData();
			}

			var action="/bpmx/platform/bpm/task/saveData.ht";
			submitForm(action,button);
		}

		// 在完成任务之前，加上判断是否需要弹出意见对话框
		function completeTaskBefore(t){
			// 加上判断是否需要弹出意见对话框
			var isPopup = '1',
				gatherNode = 'false';
			// 如果为汇总节点驳回，必须通过弹窗模式
			if(isPopup == 1 || (t&&t=='reject'&&gatherNode)){
				opintionDialog(t);
			} else {
				//如果不需要意见填写的话，进行弹框提示确认动作！
				$.ligerDialog.confirm("您确定执行此操作吗？","提示",function(rtn){
					if(rtn){
						completeTask();
					}
				});
			}
		}

		// 在完成任务之前，加上判断是否需要弹出意见对话框(驳回重写)
		function completeTaskBeforeBtn(reject,type){
			// 加上判断是否需要弹出意见对话框
			var isPopup = '1',
				gatherNode = 'false';
			// 如果为汇总节点驳回，必须通过弹窗模式
			if(isPopup == 1 || (reject&&reject=='reject'&&gatherNode)){
				opintionDialogBtn(reject,type);
			} else {
				//如果不需要意见填写的话，进行弹框提示确认动作！
				$.ligerDialog.confirm("您确定执行此操作吗？","提示",function(rtn){
					if(rtn){
						completeTask();
					}
				});
			}
		}

		//完成当前任务。
		function completeTask(){
			if($("input[name='nextPathId']").length>0){
				var b=false;//是否需要判断同步条件
				var destTask=$("input[name='destTask']:checked");
				if(destTask.length==0){
					b=true;
				}else{
					var nextPathId=destTask.parents("tr").find("[name=nextPathId]");
					if(nextPathId.length>0){
						b=true;
					}
				}
				if(b){
					var v=$("input[name='nextPathId']:checked").val();
					if(!v){
						$.ligerDialog.error("在同步条件后的执行路径中，您至少需要选择一条路径!",'提示信息');
						return;
					}
				}
			}

			// 判断每条执行路径是否已选择用户
			// @byq 每条执行路径至少要选择一个用户(update20200602 因为选人转移到了意见填写弹窗)
			// var spanSelcUser = $("span[name='spanSelectUser'],#jumpUserDiv");
			// var spanSelcUserLen = spanSelcUser.length;
			// if(spanSelcUserLen > 0) {
			// 	spanSelcUser.each(function(index,value) {
			// 		var name = $(this).children()[0].name;
			// 		var checkTaskUserId = $("input[name='"+name+"']:checked").val();
			// 		if(checkTaskUserId == null || checkTaskUserId == "") {
			// 			$.ligerDialog.warn("每条执行路径至少要选择一个用户!",'提示信息');
			// 			flag = false;
			// 			return false;
			// 		}
			// 	});
			// }

			var operatorObj=getByOperatorType();
			var button="#" +operatorObj.btnId;
			var action="/bpmx/platform/bpm/task/complete.ht";
			//执行前置脚本
			var rtn=beforeClick(operatorType);
			if( rtn==false){
				return;
			}
			//确认执行任务。
			if(isNeedSubmitConfirm){
				$.ligerDialog.confirm("您确定执行此操作吗？","提示",function(rtn){
					if(rtn){
						submitForm(action,button);
					}
				});
			}
			else{
				submitForm(action,button);
			}
		}


		function getByOperatorType(){
			var obj={};
			switch(operatorType){
				//同意
				case 1:
					obj.btnId="btnAgree";
					obj.msg="执行任务成功!";
					break;
				//反对
				case 2:
					obj.btnId="btnNotAgree";
					obj.msg="执行任务成功!";
					break;
				//弃权
				case 3:
					obj.btnId="btnAbandon";
					obj.msg="执行任务成功!";
					break;
					//驳回
				case 4:
					obj.btnId="btnReject";
					obj.msg="驳回任务成功!";
					break;
				//驳回到发起人
				case 5:
					obj.btnId="btnRejectToStart";
					obj.msg="驳回到发起人成功!";
					break;
				//保存表单
				case 8:
					obj.btnId="btnSave";
					obj.msg="保存表单数据成功!";
					break;

			}
			return obj;
		}

		function getErrorByOperatorType(){
			var rtn="";
			switch(operatorType){
				//同意
				case 1:
				//反对
				case 2:
				//弃权
				case 3:
					rtn="执行任务失败!";
					break;
				//驳回
					//驳回
				case 4:
					rtn="驳回任务失败!";
					break;
				//驳回到发起人
				case 5:
					rtn="驳回到发起人失败!";
					break;
				//保存表单
				case 8:
					rtn="保存表单数据失败!";
					break;
			}
			return rtn;
		}

		function showResponse(responseText){
			var operatorObj=getByOperatorType();
			$("#" +operatorObj.btnId).removeClass("disabled");
			var obj=new com.hotent.form.ResultMessage(responseText);
			if(obj.isSuccess()){
				$.ligerDialog.success(operatorObj.msg,'提示信息',function(){
					var rtn=afterClick(operatorType);
					if( rtn==false){
						return;
					}
                    var callback = obj.data.callback;
					handJumpOrClose(callback);
				});
			}else{
				var title=getErrorByOperatorType();
				$.ligerDialog.err('出错信息',title,obj.getMessage());
			}
		}

		//弹出回退窗口 TODO 去除
		function showBackWindow(){
			new TaskBackWindow({taskId:taskId}).show();
		}

		$(function(){

			fromUrl = window.location.href.split("urlFrom=")[1];

			initForm();
			//显示路径
			if(isHandChoolse){
				chooseJumpType(2);
			}else{
				chooseJumpType(1);
			}
			resizeIframe();
			//初始化联动设置
			

			createQRCode();

			var startNode = $("#startNode").val();
			var currentNode = $("#currentNode").val();
			if(currentNode == startNode){
				$("#btnAgree").html("<span></span>提交");
			}

            $("#jumpDiv").hide();
		});

		// 生成查看流程实例的二维码
		function createQRCode(){
			var qrcode = $("#justPrintDiv #qrcode.qrcode");
			if(!qrcode || !qrcode.length) return;
			// 设置参数方式
			var qrcode = new QRCode('qrcode', {
			  text: window.location.origin + __ctx + "/platform/bpm/processRun/getForm.ht?tab=1&runId="+runId,
			  width: 128,
			  height: 128,
			  colorDark : '#000000',
			  colorLight : '#ffffff',
			  correctLevel : QRCode.CorrectLevel.H
			});
		}

		//获取是否允许直接结束。
		function getIsDirectComplete(){
			var isDirectComlete = false;
			if($("#chkDirectComplete").length>0){
				if($("#chkDirectComplete").attr("checked")=="checked"){
					isDirectComlete = true;
				}
			}
			return isDirectComlete;
		}

		//提交第三方表单时检查该表单的参数
		function setExtFormData(){
			if(isExtForm){
				var frm=$('#frmWorkFlow');
				if(!frm.valid()) return ;
				if(frm.setData)frm.setData();
			}
		}

		function initBtnEvent(){
			//0，弃权，1，同意，2反对。
			var objVoteAgree=$("#voteAgree");
			var objBack=$("#back");

			//同意
			if($("#btnAgree").length>0){
				$("#btnAgree").click(function(){
					setDestTaskInclude(true);
					var voteContent = $('#voteContent'),
					content = voteContent.val();

					setExtFormData();

					var isDirectComlete = getIsDirectComplete();

					operatorType=1;
					//同意:5，一票通过。
					var tmp =isDirectComlete?"5":"1";

					objVoteAgree.val(tmp);
					objBack.val("0");

					// 提前校验表单
					var beforeScript=beforeClick(getByOperatorType());
					if(beforeScript==false) return;
					var rtn=CustomForm.validate({ignoreRequired:false});
					if(!rtn){
						$.ligerDialog.warn("表单验证不成功,请检查表单是否正确填写!","提示信息");
						return;
					}
					completeTaskBeforeBtn("",8);
				});
			}
			//反对
			if($("#btnNotAgree").length>0){
				$("#btnNotAgree").click(function(){
					setExtFormData();
					setDestTaskInclude(true);
					var isDirectComlete = getIsDirectComplete();
					operatorType=2;
					////直接一票通过
					var tmp =isDirectComlete?'6':'2';
					objVoteAgree.val(tmp);
					objBack.val("0");
					completeTaskBefore();
				});
			}
			//弃权
			if($("#btnAbandon").length>0){
				$("#btnAbandon").click(function(){
					setExtFormData();
					setDestTaskInclude(true);
					operatorType=3;
					objVoteAgree.val(0);
					objBack.val("");
					completeTaskBefore();
				})
			}
			//驳回
			if($("#btnReject").length>0){
				$("#btnReject").click(function(){
						setExtFormData();

						setDestTaskInclude(false);
						operatorType=4;
						objVoteAgree.val(3);
						objBack.val(1);
						//completeTaskBefore("reject");
						completeTaskBeforeBtn("reject", 10);
				})
			}
			//驳回到发起人
			if($("#btnRejectToStart").length>0){
				$("#btnRejectToStart").click(function(){
					var voteContent = $('#voteContent'),
					content = voteContent.val();
						setExtFormData();
						setDestTaskInclude(false);

						operatorType=5;
						//驳回到发起人
						objVoteAgree.val(3);
						objBack.val(2);
						completeTaskBefore();
				})
			}
			//保存表单
			if($("#btnSave").length>0){
				$("#btnSave").click(function(){
					setExtFormData();
					operatorType=8;
					saveData();
				})
			}

			//终止流程
			$("#btnEnd").click(function(){
				//isTaskEnd(endTask);
				isTaskEndOpDialog(endTaskByq);
			});
		}


		//驳回时设置是否提交目标路径。
		function setDestTaskInclude(isNeed){
			$("[name='destTask']").each(function(){
				if(isNeed){
					$(this).attr("include","1");
				}
				else{
					$(this).removeAttr("include");
				}
			})
		}

		// 弹出意见对话框
		function opintionDialog(reject){
			var isRequired = '1';
			var actDefId = $("#actDefId").val();
			var url= __ctx + '/platform/bpm/task/opDialog.ht?taskId=2000000002354505&isRequired=' +isRequired+'&actDefId='+actDefId + '&reject=' + reject;
			var voteContent = $("#voteContent").val();
			DialogUtil.open({
				height:350,
				width: 500,
				title : '填写意见',
				url: url,
				isResize: true,
				//自定义参数
				voteContent:voteContent,
				sucCall:function(rtn){
					if(typeof rtn=="string"){
						// 填写到系统的意见
						$("#voteContent").val(rtn);
					}
					else if(typeof rtn=="object"){
						// 填写到系统的意见
						$("#voteContent").val(rtn.opinion);
						$("#forkTask2Reject").val(rtn.forkTask2Reject);
					}
					// 完成当前任务
					completeTask();
				}
			});
		}

		// 弹出意见对话框（重写）
		function opintionDialogBtn(reject, type){
			var isRequired = '1';
			var actDefId = $("#actDefId").val();
			var url= __ctx + '/platform/bpm/task/opDialogBtn.ht?taskId=2000000002354505&isRequired=' +isRequired+'&actDefId='+actDefId + '&reject=' + reject + '&type=' + type;
			var voteContent = $("#voteContent").val();
			DialogUtil.open({
				height:450,
				width: 600,
				title : '填写意见',
				url: url,
				isResize: true,
				//自定义参数
				voteContent:voteContent,
				sucCall:function(rtn){
					if(typeof rtn=="string"){
						// 填写到系统的意见
						$("#voteContent").val(rtn);
					}
					else if(typeof rtn=="object"){
						// 填写到系统的意见
						$("#voteContent").val(rtn.opinion);
						$("#forkTask2Reject").val(rtn.forkTask2Reject);
                        // 回填选人后的html
                        if(rtn.destTask){
                            $("input[name='destTask']").val(rtn.destTask);
                        }
                        if(rtn.lastDestTaskId) {
                            $("input[name='lastDestTaskId']").val(rtn.lastDestTaskId);
                        }
                        if(rtn.spanSelectUser) {
                            $("span[name='spanSelectUser']").html(rtn.spanSelectUser);
                        }
					}
					// 完成当前任务
					completeTask();
				}
			});
		}

		//终止流程。
		function endTask(){
			var url=__ctx + "/platform/bpm/task/toStartEnd.ht";
			url=url.getNewUrl();

			DialogUtil.open({
				height:250,
				width: 400,
				title : '终止流程',
				url: url,
				isResize: true,
				//自定义参数
				sucCall:function(rtn){
					var url="/bpmx/platform/bpm/task/endProcess.ht?taskId=2000000002354505";
					var params={taskId:taskId,memo:rtn};
					$.post(url,params,function(responseText){
						var obj=new com.hotent.form.ResultMessage(responseText);
						if(!obj.isSuccess()){
							$.ligerDialog.err("提示信息","终止任务失败!",obj.getMessage());
							return;
						}
						$.ligerDialog.success(obj.getMessage(),"提示信息",function(){
							handJumpOrClose();
						});
					});
				}
			});
		}

		function handJumpOrClose(){
			//如果按钮类型为保存则不关闭窗口。
			if(operatorType==8) return;
			var tab = top.$("#framecenter").ligerGetTabManager();
			/*if(window.opener){
				try{
					window.opener.location.href=window.opener.location.href.getNewUrl();
				}
				catch(e){}
			}*/
			if(tab!=null){
				top.$("iframe#"+tabid)[0].contentWindow.location.reload();
				tab.removeSelectedTabItem();
			}else{
				//window.close();
				var flag = navigator.userAgent.match(
				        /(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i
				      );
				var mobileFlag = flag == null ? false : true;
				if(mobileFlag){
                    // 判断是否钉钉
                    if(dd.env.platform != 'notInDingTalk'){
                        dd.ready(function(){
                            dd.biz.navigation.close({
                                onSuccess : function(result){
                                    return;
                                },
                                onFail : function(err){
                                    return;
                                }
                            });
                        });
                    }else if (navigator.userAgent.indexOf('zfsoft') != -1) {
						//判断是否正方云App，则执行app的返回方法
						var u = navigator.userAgent;
						var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
						if (isiOS) {
							window.webkit.messageHandlers.GoBack.postMessage({});
						} else {
							window.android.GoBack();
						}
					} else {
						var u = navigator.userAgent;
						var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
						if (isiOS) {
							window.location.href = document.referrer;
						} else {
							if( fromUrl==null || fromUrl == "" ){
								window.location.href = document.referrer;
							}else{
								window.location.href = fromUrl;
							}
						}
					}
				}else{
					window.close();
				}
			}
		}

        function handJumpOrClose(callback){
            //如果按钮类型为保存则不关闭窗口。
            if(operatorType==8) return;
            var tab = top.$("#framecenter").ligerGetTabManager();
            /*if(window.opener){
                try{
                    window.opener.location.href=window.opener.location.href.getNewUrl();
                }
                catch(e){}
            }*/
            if(tab!=null){
                top.$("iframe#"+tabid)[0].contentWindow.location.reload();
                tab.removeSelectedTabItem();
            }else{
                //window.close();
                var flag = navigator.userAgent.match(
                    /(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i
                );
                var mobileFlag = flag == null ? false : true;
                if(mobileFlag){
                    // 判断是否钉钉
                    if(dd.env.platform != 'notInDingTalk'){
                        dd.ready(function(){
                            dd.biz.navigation.close({
                                onSuccess : function(result){
                                    return;
                                },
                                onFail : function(err){
                                    return;
                                }
                            });
                        });
                    }else{
                        window.location.href=callback;
                    }
                }else{
                    window.close();
                }
            }
        }

		function initForm(){
			//初始化按钮事件。
			initBtnEvent();

			if(isEmptyForm) return;

			if(isExtForm){
				form=$('#frmWorkFlow').form({excludes:"[type=append]"});
				var formUrl=$('#divExternalForm').attr("formUrl");
				$('#divExternalForm').load(formUrl, function() {
					hasLoadComplete=true;
					//动态执行第三方表单指定执行的js
					try{
						afterOnload();
					}catch(e){}
					initSubForm();
					//OfficePlugin.init();
				});
			}else{
				$(".taskopinion").each(function(){
					$(this).removeClass("taskopinion");
					var actInstId=$(this).attr("instanceId");
					if(actInstId){
					    $(this).load("/bpmx/platform/bpm/taskOpinion/listform.ht?actInstId="+actInstId);
					}
				});

			}
		}

		function initSubForm(){
			$('#frmWorkFlow').ajaxForm({success:showResponse });
		}

		function showRoleDlg(){
			RoleDialog({callback:function(roleId,roleName){$('#forkUserUids').val(roleId);}});
		}

		function chooseJumpType(val){
			//如果是沟通不需要显示跳转信息，而且它没有executionId 会报错
			if(false) return;
			if(isHidePath&&isManage==0) return;
			var obj=$('#jumpDiv');
			var url="";
			if(val==1){
				url="/bpmx/platform/bpm/task/tranTaskUserMap.ht?taskId=2000000002354505&selectPath=0";
			}
			//选择路径跳转
			else if(val==2){
				url="/bpmx/platform/bpm/task/tranTaskUserMap.ht?taskId=2000000002354505";
			}
			//自由跳转
			else if(val==3){
				url="/bpmx/platform/bpm/task/freeJump.ht?taskId=2000000002354505";
			}

			url=url.getNewUrl();

			if(val==3){  //自由跳转
				$.ajaxSetup({async:false});  //同步 获得结果后  再去查询相关的人员
				obj.html(obj.attr("tipInfo")).show().load(url);
				$.ajaxSetup({async:true}); //异步
				//自由跳转 时 从下拉节点的默认的值 中查出相关的人员
				var destTask=$('#destTask');   //默认的选中的对象
				changeDestTask(destTask);    //查出相关的人员 并改显示出来
			}else{
				obj.html(obj.attr("tipInfo")).show().load(url);
			}
		}

		//为目标节点选择执行的人员列表
		function selExeUsers(obj,nodeId,scope){
			var span=$(obj).siblings("span");

			var aryChk=$(":checkbox",span);
			var selectExecutors =[];
			aryChk.each(function(){
				var val=$(this).val();
			    var k=val.split("^");
				var userObj={};
				userObj.type=k[0];
				userObj.id=k[1];
				userObj.name=k[2];
				selectExecutors.push(userObj);
			});

			if(!scope){
				scope={};
				scope.type='system',
				scope.value='all';
				scope=JSON2.stringify(scope);
			}else{
				scope=scope.replaceAll("#@","\"");
			}


			FlowUserDialog({selectUsers:selectExecutors,scope:scope,callback:function(types,objIds,objNames){
				if(objIds==null) return;
				var aryTmp=[];
				for(var i=0;i<objIds.length;i++){
					var check="<input type='checkbox' include='1' name='" + nodeId + "_userId' checked='checked' value='"+types[i] +"^"+  objIds[i]+"^"+objNames[i] +"'/>&nbsp;"+objNames[i];
					aryTmp.push(check);
				}
				span.html(aryTmp.join(''));
			}});
		}

		function selectExeUsers(obj,scope){
			var destTask=$("#destTask");
			if(destTask){
				$("#lastDestTaskId").val(destTask.val());
			}
			selExeUsers(obj,destTask.val(),scope);
		}
		//显示审批历史
		function showTaskOpinions(){
			var url="/bpmx/platform/bpm/taskOpinion/list.ht?runId=2000000002262650&isOpenDialog=1";
			url=url.getNewUrl();
			DialogUtil.open({
				url:url,
				title:'审批历史',
				height:'600',
				width:'800'
			});
		}
		//更改
		function changeDestTask(sel){
			var nodeId=sel.value;
			if(typeof nodeId == 'undefined'){    //对象不是用原始JS的，而是通过Jquery获取的对象
				nodeId = sel.val();
			}
			if(typeof nodeId == 'undefined' || nodeId==null || nodeId==""){
				$('#jumpUserDiv').html("");
				$('#lastDestTaskId').val("");
				return;
			}
			$('#lastDestTaskId').val(nodeId);
			var url="/bpmx/platform/bpm/task/getTaskUsers.ht?taskId=2000000002354505&nodeId="+nodeId;
			$.getJSON(url, function(dataJson){
				var data=eval(dataJson);
				var aryHtml=[];
				for(var i=0;i<data.length;i++){
				  var span="<input type='checkbox' include='1' name='" + nodeId + "_userId' checked='checked' value='"+data[i].type+"^"+data[i].executeId+"^"+data[i].executor+"'/>&nbsp;"+data[i].executor;
				  aryHtml.push(span);
				}
				$('#jumpUserDiv').html(aryHtml.join(''));
			});

		}

		function isTaskEnd(callBack){
			var url="/bpmx/platform/bpm/task/isTaskExsit.ht";
			var params={taskId:"2000000002354505"};

			$.post(url,params,function(responseText){
				var obj=new com.hotent.form.ResultMessage(responseText);
				if(obj.isSuccess()){
					callBack.apply(this);
				}
				else{
					$.ligerDialog.warn("当前任务已经完成或被终止","提示信息");
				}
			});
		}

		//终止流程（byq）
		function isTaskEndOpDialog(callBack){
			var actDefId = $("#actDefId").val();
			var voteContent = $("#voteContent").val();
			var type = 9;
			var url="/bpmx/platform/bpm/task/isTaskEndOpDialog.ht?taskId=2000000002354505&actDefId="+actDefId+"&type="+type;

			DialogUtil.open({
				height:350,
				width: 500,
				title : '填写意见',
				url: url,
				isResize: true,
				//自定义参数
				voteContent:voteContent,
				sucCall:function(rtn){
					var url="/bpmx/platform/bpm/task/endProcess.ht?taskId=2000000002354505";
					var params={taskId:taskId,memo:rtn};
					$.post(url,params,function(responseText){
						var obj=new com.hotent.form.ResultMessage(responseText);
						if(!obj.isSuccess()){
							$.ligerDialog.err("提示信息","终止任务失败!",obj.getMessage());
							return;
						}
						$.ligerDialog.success(obj.getMessage(),"提示信息",function(){
							handJumpOrClose();
						});
					});
				}
			});
		}

		//终止流程。
		function endTaskByq(){
			var url=__ctx + "/platform/bpm/task/toStartEnd.ht";
			url=url.getNewUrl();

			DialogUtil.open({
				height:250,
				width: 400,
				title : '终止流程',
				url: url,
				isResize: true,
				//自定义参数
				sucCall:function(rtn){
					var url="/bpmx/platform/bpm/task/endProcess.ht?taskId=2000000002354505";
					var params={taskId:taskId,memo:rtn};
					$.post(url,params,function(responseText){
						var obj=new com.hotent.form.ResultMessage(responseText);
						if(!obj.isSuccess()){
							$.ligerDialog.err("提示信息","终止任务失败!",obj.getMessage());
							return;
						}
						$.ligerDialog.success(obj.getMessage(),"提示信息",function(){
							handJumpOrClose();
						});
					});
				}
			});
		}

		//转交待办
		function changeAssignee(){
			if(true){
				isTaskEnd(function(){
					 BpmTaskExeAssignDialog({taskId:taskId,callback:function(rtn){
						if(rtn){
							handJumpOrClose();
						}
					}
					});
				});
			}
			else{
				$.ligerDialog.warn("当前任务不能转办!","提示信息");
			}
		}

		//转发
		function retransmission(){
			isTaskEnd(function(){
				BpmRetransmissionDialog({runId:runId,callback:function(rtn){
					if(rtn){
						handJumpOrClose();
					}
				}
				});
			});
		}


		function resizeIframe(){
			if($("#frameDetail").length==0) return;
			$("#frameDetail").load(function() {
				$(this).height($(this).contents().height()+20);
			}) ;
		}


		// 选择常用语
		function addComment(){
			var objContent=document.getElementById("voteContent");
			var selItem = $('#selTaskAppItem').val();
			jQuery.insertText(objContent,selItem);
		}

		function openForm(formUrl){
			var winArgs="dialogWidth=500px;dialogHeight=400px;help=0;status=0;scroll=0;center=1";
			var url=formUrl.getNewUrl();
			window.open(url,"",winArgs);
		}

		function reference(){
			var defId=2000000000060437;

			var url="/bpmx/platform/bpm/processRun/getRefList.ht?defId=" +defId;

			var params="height=400,width=700,status=no,toolbar=no,menubar=no,location=no,resizable=1,scrollbars=1";
			window.open(url);
		}

		function openHelpDoc(fileId){
			var h=screen.availHeight-35;
			var w=screen.availWidth-5;
			var vars="top=0,left=0,height="+h+",width="+w+",status=no,toolbar=no,menubar=no,location=no,resizable=1,scrollbars=1";
			var showUrl = __ctx+"/platform/form/office/get.ht?fileId=" + fileId;
			window.open(showUrl,"myWindow",vars);
		}

		//增加Web签章
		/* function addWebSigns(){
			AddSecSignFromServiceX();          //WebSignPlugin JS类
		} */

		//增加手写签章
		/* function addHangSigns(){
			AddSecHandSignNoPromptX();          //WebSignPlugin JS类
		} */

		// 自定义打印
		function customPrint(printAlias){
			var url="/bpmx/platform/bpm/processRun/printForm.ht?runId=2000000002262650&printAlias="+printAlias;
			jQuery.openFullWindow(url);
		}


		//流程引用控件超链接访问流程实例
		function openProRun(obj){
			var runId = $(obj).attr("runid");
			var url="/bpmx/platform/bpm/processRun/info.ht?link=1&runId="+runId;
			jQuery.openFullWindow(url);
		}

		//打印表单
		function printForm(runId){
			var url="/bpmx/platform/bpm/processRun/printForm.ht?runId="+runId;
			jQuery.openFullWindow(url);
		}

        //直接打印
        function justPrint(){
            var headstr = "<html><head><title></title></head><body>";
            var footstr = "</body>";
            var printData = document.getElementById("justPrintDiv").innerHTML;
            var oldstr = document.body.innerHTML;
            document.body.innerHTML = headstr+printData+footstr;
            window.print();
            document.body.innerHTML = oldstr;
            return false;
        }

		function generatePDF(runId){
			$.get("/bpmx/platform/bpm/processRun/generatePDF.ht?runId="+runId,function(data,status){
				console.log("Data: " + data + "\nStatus: " + status);
			    if(status == "success"){
			        if(data != null && data != ""){
                        $.ligerDialog.warn("生成PDF成功！","提示信息");
                        window.open(data);
                    }else{
                        $.ligerDialog.warn("暂不支持生成PDF！请联系管理员！","提示信息");
					}
			    }else{
			    	$.ligerDialog.warn("生成PDF失败！","提示信息");
			    }
			});
		}

        function generatePDFToSigna(runId){
            $.get("/bpmx/platform/bpm/processRun/generatePDFToSigna.ht?runId="+runId,function(data,status){
                console.log("Data: " + data + "\nStatus: " + status);
                if(status == "success") {
                    if (data != null && data != "") {
                        $.ligerDialog.warn("生成盖章文件成功！", "提示信息");
                        window.open(data);
                    }else{
                        $.ligerDialog.warn("暂不支持生成盖章文件！请联系管理员！","提示信息");
                    }
                }else{
                    $.ligerDialog.warn("生成盖章文件失败！","提示信息");
                }
            });
        }

		// 徐州工业支付按钮方法
		function orderPay(){
		    // 新增时间判断 5点-16点半
			if(!thisDate()){
			    return false;
			}
			var paytype=$('input:radio[class="paytype"]:checked').val();
			var flag = navigator.userAgent.match(
					/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i
			);
			var mobileFlag = flag == null ? false : true;
			var url="";
			if (paytype=='alipay'){
				if(mobileFlag){
					url="/bpmx/platform/alipay/ali/pay.ht?runId="+runId;
				}else{
					url="/bpmx/platform/alipay/ali/pay.ht?runId="+runId;
				}
				window.open(url, '_blank');
			}else if (paytype=='wxpay'){
				if(mobileFlag){
					$.ajax({
						type : "POST",
						url : __ctx + "/platform/Wxpay/wx/mobilepay.ht",
						data : {
							runId : runId
						},
						success : function(data) {
							var d = $.parseJSON(data);
							if(d.falg=="true"){
								$.ligerDialog.alert("微信支付成功，正在跳转链接！","提示信息",function() {
									location.href = d.mweburl;
								});
							}else{
								$.ligerDialog.err("提示信息","微信支付失败!",d.msg);
							}
						}
					});
				}else {
					url="/bpmx/platform/Wxpay/wx/pay.ht?runId="+runId;
					win= DialogUtil.open({title:"微信支付", url: url, height: 450,width:550 ,isResize: false,pwin:window });
				}
			}
		}

        // 省教育厅盖章按钮方法
		function addSigns(runId){
			//$("#fjscTr").hide();
			$.get("/bpmx/platform/bpm/processRun/addSigns.ht?runId="+runId,function(data,status){
				console.log("Data: " + data + "\nStatus: " + status);
			    if(data.status == "success"){
					$.ligerDialog.warn("盖章成功！","提示信息");
					if("zkmkkszy" == data.tableName){
						$("[name='m:dzkhgkckszydqr:fjsc']").val(data.tomcatPath);
					}else if("pthzm" == data.tableName){
						$("[name='m:pthspcsdjzmbf:fj']").val(data.tomcatPath);
						$("#gzwj").show();
						$("[name='m:pthspcsdjzmbf:gzwj']").val("<a href='"+data.gz_outFileName+"' target='_blank'>普通话水平测试等级证明书</a>");
						$("[name='m:pthspcsdjzmbf:gzwj']").hide();
						$("#gzwjlj").html("<a href='"+data.gz_outFileName+"' target='_blank'>普通话水平测试等级证明书</a>");
					}
					window.open(data.gz_outFileName);
			    }else{
			    	$.ligerDialog.warn("盖章失败！","提示信息");
			    }
			});
		}

		// 生成pdf按钮通用方法
		function html2PDF(runId){
        	var url = "/bpmx/platform/bpm/processRun/formToPDF.ht?runId="+runId
            $.get(url,function(data,status){
                console.log("Data: " + data + "\nStatus: " + status);
                if(status == "success"){
                    if(data != null && data != ""){
                        $.ligerDialog.warn("生成PDF成功！","提示信息");
                        //window.open(data);
                    }else{
                        $.ligerDialog.warn("暂不支持生成PDF！请联系管理员！","提示信息");
                    }
                }else{
                    $.ligerDialog.warn("生成PDF失败！","提示信息");
                }
            });
        }

		//固定模板签章
		function ToPDF(runId){
			console.log("进入ToPDF");
			var url = "/bpmx/platform/bpm/processRun/generatePDFToSigna.ht?runId="+runId
			$.get(url,function(data,status){
				if(status == "success"){
					if(data != null && data != ""){
						$.ligerDialog.warn("签章成功！","提示信息");
                        window.open(data);
					}else{
						$.ligerDialog.warn("签章失败！请联系管理员！","提示信息");
					}
				}else{
					$.ligerDialog.warn("签章失败！","提示信息");
				}
			});
		}

		//临沂职业学院非固定模板签章
		function ToPDF2(fileId){
			console.log("进入ToPDF2");
			var url = "/bpmx/platform/bpm/processRun/LyformToPDF2.ht?fileId="+fileId
			$.get(url,function(data){
				if(data != null && data != ""){
					if(data.message == "成功"){
						var path = data.data.url;
						window.open(path)
					}else{
						$.ligerDialog.warn(data.message,"提示信息");
					}
				}else{
					$.ligerDialog.warn("签章失败！","提示信息");
				}
			});
		}

		//临沂职业学院推送打印平台
		function ToPrint(runId){
			console.log("进入ToPrint");
			var url = "/bpmx/platform/bpm/processRun/result.ht?runId="+runId
			$.get(url,function(data,status){
				if(status == "success"){
					if(data != null && data != ""){
						var path = data.printPath
						var xgh = data.xgh
						var fileName = data.fileName
						var url = "/bpmx/platform/bpm/processRun/ToPrint.ht?path="+path+"&xgh="+xgh+"&fileName="+fileName
						$.get(url,function(data,status){
							console.log(data);
							if(data != null && data != ""){
								console.log(JSON.parse(data));
								if(JSON.parse(data).resultCode == 0){
									$.ligerDialog.warn("打印成功！","提示信息");
								}else{
									$.ligerDialog.warn(data.result,"提示信息");
								}
							}else{
								$.ligerDialog.warn("打印失败！请联系管理员！","提示信息");
							}
						});
					}else{
						$.ligerDialog.warn("文件不存在！请联系管理员！","提示信息");
					}
				}else{
					$.ligerDialog.warn("打印失败！","提示信息");
				}
			});
		}

		//临沂职业学院签署文件下载
		function ToDownload(runId){
			console.log("进入ToDownload");
			var url = "/bpmx/platform/bpm/processRun/result.ht?runId="+runId
			$.get(url,function(data,status){
				if(data != null && data != ""){
					var path = data.path
					window.open(path)
				}else{
					$.ligerDialog.warn("文件不存在！请联系管理员！","提示信息");
				}
			});
		}

	

}
).toString().slice(12, -2),"");</script>

</head>
<body>
	<form id="frmWorkFlow" method="post">
		 <div class="panel">
		 		<div class="panel-top"> 
		            <!-- 悬浮工具栏实现的对象topNavWrapper 和 topNav 名称ID可以更改,但要和css的对象一致-->
		            <div id="topNavWrapper">
						<ul id="topNav">
						  <iframe style="position:absolute; visibility:inherit; top:0px; left:0px; width:100%; height:70px; z-index:-1; border-width:0px;" src="./流程任务-[销假申请]执行_files/saved_resource.html"></iframe>									
					      <div class="l-layout-header noprint">
			            	任务审批处理--<b>销假申请</b>--<i>[学生请假申请-V1]</i>
				          </div>
				          
				            	
				            	
				            	
				            		




<script type="text/javascript">vpn_eval((function(){

	function beforeClick(operatorType){
		switch(operatorType){
			}
	}

	function afterClick(operatorType){
		switch(operatorType){
			}
	}



}
).toString().slice(12, -2),"");</script>
<div class="noprint">
	<div class="panel-toolbar">
		<div class="toolBar">
			<div class="flowLogo">
				<img class="pcLogo" alt="" src="./流程任务-[销假申请]执行_files/logo.png">
				<img class="mobileLogo" alt="" src="./流程任务-[销假申请]执行_files/mobileLogo.png">
			</div>
			<div class="flowButton">
				
					
						
							
							
								
									
									
										
											
												<!--  同意-->
												<div class="group"><a id="btnAgree" class="link agree"><span></span>返校后申请销假</a></div>
												<div class="l-bar-separator"></div>
											
											
											
											
											
											
											

											
											
											
											
											
											
											
											
											
											
											
											
											
											
											
											
										
									
										
											
											
											
											
											
											
											

											
											
											
											
											
												<!--流程图-->
												<div class="group"><a class="link setting" onclick="var vpn_return;eval(vpn_rewrite_js((function () { showTaskUserDlg() }).toString().slice(14, -2), 2));return vpn_return;"><span></span>流程图</a></div>
												<div class="l-bar-separator"></div>
											
											
											
											
											
											
											
											
											
											
											
											
										
									
										
											
											
											
											
											
											
											

											
											
											
											
											
											
												
													
													
														<div class="group"><a class="link print" onclick="var vpn_return;eval(vpn_rewrite_js((function () { justPrint(); }).toString().slice(14, -2), 2));return vpn_return;"><span></span>打印</a></div>
														<div class="l-bar-separator"></div>
													
												
											
											
											
											
											
											
											
											
											
											
											
										
									
								
								
							
						
					
					
				
				
					
						<div class="chooseJumpType">
							
							
							
						</div>
					
					
				
				
				
			</div>
		</div>
	</div>
</div>
				            	
				          
						</ul>
					</div>
		         </div>

				<div class="panel-body" style="margin: 105px 15px 10px;">
					
						
					
					
					<!--审批意见-->
					
						
						
		            		<div class="hidden">
		            		<textarea class="hidden" include="1" id="voteContent" name="voteContent"></textarea>
		            		</div>
		            	
					
					<div class="panel-detail">
							
								
								
									
										<div align="right">申报号：202201890038</div>
									
									
										
										
											<div class="printForm" type="custform" id="justPrintDiv">
											 
 <link rel="stylesheet" type="text/css" href="./流程任务-[销假申请]执行_files/column_div_1216.css"> 
 <script type="text/javascript" src="./流程任务-[销假申请]执行_files/table.js.下载"></script> 
 <div class="page formTable"> 
  <h1>青岛科技大学学生请假申请表</h1> 
  <div class="content formTable" id="xsjbxx"> 
   <div class="title"> 
    <p>学生基本信息</p> 
   </div> 
   <div class="table-cell"> 
    <div class="block"> 
     <p class="title">学号</p> 
     <div class="block-input"> 
      <span name="m:xsqjsq:xh">1902070202</span> 
     </div> 
    </div> 
    <div class="block"> 
     <p class="title">姓名</p> 
     <div class="block-input"> 
      <span name="m:xsqjsq:xm">曹桂川</span> 
     </div> 
    </div> 
   </div> 
   <div class="table-cell"> 
    <div class="block"> 
     <p class="title">学院</p> 
     <div class="block-input"> 
      <span name="m:xsqjsq:xy">化学与分子工程学院</span> 
     </div> 
    </div> 
    <div class="block"> 
     <p class="title">年级</p> 
     <div class="block-input"> 
      <span name="m:xsqjsq:nj">2019</span> 
     </div> 
    </div> 
   </div> 
   <div class="table-cell"> 
    <div class="block"> 
     <p class="title">专业</p> 
     <div class="block-input"> 
      <span name="m:xsqjsq:zy">分子科学与工程</span> 
     </div> 
    </div> 
    <div class="block"> 
     <p class="title">班级</p> 
     <div class="block-input"> 
      <span name="m:xsqjsq:bj">分子科学192</span> 
     </div> 
    </div> 
   </div> 
   <div class="table-cell"> 
    <div class="block"> 
     <p class="title">辅导员</p> 
     <div class="block-input"> 
      <span name="m:xsqjsq:fdy">刘施施</span> 
     </div> 
    </div> 
    <div class="block"> 
     <p class="title"><br></p> 
     <div class="block-input"> 
      <span style="display:none" name="m:xsqjsq:xyld">杨小明</span> 
     </div> 
    </div> 
   </div> 
   <div class="table-cell" style="display:none"> 
    <div class="block"> 
     <p class="title">辅导员ID</p> 
     <div class="block-input"> 
      <span name="m:xsqjsq:fdyid">1197</span> 
     </div> 
    </div> 
    <div class="block"> 
     <p class="title">学院领导ID</p> 
     <div class="block-input"> 
      <span name="m:xsqjsq:xyldid">2064</span> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="content formTable" id="qjxx"> 
   <div class="title"> 
    <p>请假信息</p> 
   </div> 
   <div class="table-cell"> 
    <div class="block"> 
     <p class="title">请假开始日期</p> 
     <div class="block-sjxzq"> 
      <span name="m:xsqjsq:qjksrq">2022-01-09</span> 
     </div> 
    </div> 
    <div class="block"> 
     <p class="title">请假结束日期</p> 
     <div class="block-sjxzq"> 
      <span name="m:xsqjsq:qjjsrq">2022-01-10</span> 
     </div> 
    </div> 
    <div class="block"> 
     <p class="title">请假天数</p> 
     <div class="block-input"> 
      <span name="m:xsqjsq:qjts">2.0</span> 
     </div> 
    </div> 
    <div class="block"> 
     <p class="title">请假类型</p> 
     <div class="block-select"> 
      <input type="hidden" name="m:xsqjsq:qjlx" value="事假">
      <span id="qjlx" name="m:xsqjsq:qjlx">事假</span> 
     </div> 
    </div> 
    <div class="table-cell"> 
     <div class="block block-oneline"> 
      <p class="title">请假事由</p> 
      <div class="block-textarea"> 回家 
      </div> 
     </div> 
    </div> 
    <div class="table-cell"> 
     <div class="block block-oneline"> 
      <p class="title">附件材料</p> 
      <div class="block-fjsc"> 
       <div name="div_attachment_container" right="r"><div class="attachement"></div><textarea style="display:none" controltype="attachment" name="m:xsqjsq:fjcl" lablename="附件" validatable="true" validate="{}"></textarea></div> 
      </div> 
     </div> 
    </div> 
   </div> 
  </div> 
 </div> 
 <p><br></p> 
 <div class="content startHis"> 
  <div class="title"> 
   <p>审批历史</p> 
  </div> 
  <div class="table-scroll"> 
   <div class="" instanceid="2000000002262653">

<meta content="IE=edge" http-equiv="X-UA-Compatible">
<link rel="shortcut icon" href="https://wvpn.qust.edu.cn/http/77726476706e69737468656265737421f2e74cd236257b44300d8db9d6562d/bpmx/image/favicon.ico?vpn-6" type="image/x-icon">










<table class="table-grid">
	<tbody><tr>
		<th>任务节点</th>
		<th>开始时间</th>
		<th>结束时间</th>
		<th>经历时间</th>
		<th>执行人</th>
		<th>审批意见</th>
		<th>审批状态</th>
	</tr>
	
		
			<tr>
				
					<td>学生请假申请</td>
				
				<td>2022-01-08 15:33:40</td>
				<td>2022-01-08 15:33:40</td>
				<td>
					
		              			0分钟
		              		
				</td>
				<td>
					
						
							曹桂川
						
						
					
				</td>
				<td>
					同意(自动审批)
					
					
				</td>
				<td>
					<font color="green">同意</font>
				</td>
			</tr>
		
	
		
			<tr>
				
					<td>辅导员意见</td>
				
				<td>2022-01-08 15:33:40</td>
				<td>2022-01-09 16:34:04</td>
				<td>
					
		              			1天1小时23秒
		              		
				</td>
				<td>
					
						
							刘施施
						
						
					
				</td>
				<td>
					同意
					
					
				</td>
				<td>
					<font color="green">同意</font>
				</td>
			</tr>
		
	
		
			<tr>
				
					<td>销假申请</td>
				
				<td>2022-01-09 16:34:04</td>
				<td></td>
				<td>
					
				</td>
				<td>
					
						
							曹桂川
						
						
					
				</td>
				<td>
					
					
					
				</td>
				<td>
					尚未处理
				</td>
			</tr>
		
	
</tbody></table>

<textarea id="txtReceiveTemplate" style="display: none;">    &lt;div style="height:150px;width:150px;overflow:auto"&gt;

	  		&lt;list data as obj&gt;
	  		&lt;table class="table-detail" cellpadding="0" cellspacing="0" border="0"&gt;
	  		&lt;tr&gt;
	  			&lt;th&gt;接收人&lt;/th&gt;
	  			&lt;td&gt;${obj.receivername }&lt;/td&gt;
	  		&lt;/tr&gt;
	  		&lt;tr&gt;
	  			&lt;th&gt;状态&lt;/th&gt;
	  			&lt;td&gt;
	  				&lt;if (obj.status="=0)"&gt;
	  					&lt;span class="red"&gt;未读&lt;/span&gt;
	  				&lt;elseif (obj.status="=1)"&gt;
	  					&lt;span class="green"&gt;已读&lt;/span&gt;
	  				&lt;elseif (obj.status="=2)"&gt;
	  					&lt;span class="green"&gt;已反馈&lt;/span&gt;
	  				&lt;elseif (obj.status="=3)"&gt;
	  					&lt;span class="red"&gt;已取消&lt;/span&gt;
	  				&lt;/#if&gt;
				&lt;/td&gt;
	  		&lt;/tr&gt;
	  		&lt;if (obj.status="=0)"&gt;
		  		&lt;tr&gt;
		  			&lt;th&gt;创建时间&lt;/th&gt;
		  			&lt;td&gt;${obj.createtimeStr}&lt;/td&gt;
		  		&lt;/tr&gt;
		  	&lt;elseif (obj.status="=1)"&gt;
			  	&lt;tr&gt;
		  			&lt;th&gt;接收时间&lt;/th&gt;
		  			&lt;td&gt;${obj.receivetimeStr}&lt;/td&gt;
			  	&lt;/tr&gt;
		  	&lt;elseif (obj.status="=2)"&gt;
		  		&lt;tr&gt;
		  			&lt;th&gt;反馈时间&lt;/th&gt;
		  			&lt;td&gt;${obj.feedbacktimeStr}&lt;/td&gt;
		  		&lt;/tr&gt;
		  	&lt;elseif (obj.status="=3)"&gt;
		  		&lt;tr&gt;
		  			&lt;th&gt;取消时间&lt;/th&gt;
		  			&lt;td&gt;${obj.feedbacktimeStr}&lt;/td&gt;
		  		&lt;/tr&gt;
	  		&lt;/#if&gt;
		&lt;/table&gt;
	  		&lt;/#list&gt;

	&lt;/div&gt;
  </textarea></div> 
  </div> 
 </div> 
 <p><br></p> 
 <script type="text/javascript">vpn_eval((function(){
 var permission = {"subTableShow":{},"formTabPermission":{"页面1":"r"},"field":{"xyld":"r","xy":"r","fjcl":"r","bj":"r","qjsy":"r","qjts":"r","xh":"r","qjlx":"r","xyldid":"r","xm":"r","fdy":"r","fdyid":"r","qjjsrq":"r","qjksrq":"r","nj":"r","zy":"r"},"teamPermission":{"xsjbxx":"r","qjxx":"r"},"subFieldJson":{},"table":{},"menuRight":{},"opinion":{}} 

}
).toString().slice(12, -2),"");</script> 
 <script type="text/javascript">vpn_eval((function(){
 var permission = {"subTableShow":{},"formTabPermission":{"页面1":"r"},"field":{"xyld":"r","xy":"r","fjcl":"r","bj":"r","qjsy":"r","qjts":"r","xh":"r","qjlx":"r","xyldid":"r","xm":"r","fdy":"r","fdyid":"r","qjjsrq":"r","qjksrq":"r","nj":"r","zy":"r"},"teamPermission":{"xsjbxx":"r","qjxx":"r"},"subFieldJson":{},"table":{},"menuRight":{},"opinion":{}} 

}
).toString().slice(12, -2),"");</script>

											</div>
											<input type="hidden" include="1" name="formData" id="formData">
										
										
								
							
					</div>
					<input type="hidden" id="taskId" include="1" name="taskId" value="2000000002354505"> 
					
					
						
						
							<input type="hidden" include="1" id="voteAgree" name="voteAgree" value="1">
						
					
					<input type="hidden" include="1" id="back" name="back" value="">
					<input type="hidden" include="1" id="actDefId" name="actDefId" value="xsqjsq:1:2000000000060436">
					<input type="hidden" include="1" name="defId" value="2000000000060437">
					<input type="hidden" include="1" id="isManage" name="isManage" value="0">
					<input type="hidden" include="1" id="businessKey" name="businessKey" value="2000000002262651">
					<input type="hidden" include="1" id="startNode" name="startNode" value="UserTask1">
					<input type="hidden" include="1" name="curUserId" value="102031">
		            <input type="hidden" include="1" name="curUserName" value="曹桂川">
		            <input type="hidden" include="1" id="currentNode" name="currentNode" value="UserTask4">
		            <input type="hidden" include="1" name="formKey" value="xsqjsqb">
		            <input type="hidden" include="1" id="forkTask2Reject" name="forkTaskRejects"> 
		            <input type="hidden" include="1" id="isCanBack" name="isCanBack" value="true"> 
		            <input type="hidden" include="1" id="gatherNode" name="gatherNode" value="false"> 
				</div>
         </div>
         
    </form>


<div style="position: fixed; z-index: 10000; height: 30px; bottom: 0px; right: 0px; padding: 0px 30px 0px 10px; background-color: rgba(255, 255, 255, 0.5);"><div style="pointer-events: none; font-size: 14px; line-height: 30px; color: rgb(0, 153, 204);">您正在使用VPN</div><div style="position: absolute; right: 10px; top: 5px; cursor: pointer;"><svg width="16" height="16" viewBox="0 0 32 32">
    <path stroke="#aaa" stroke-width="2px" fill="none" d="M32 12.408l-11.056-1.607-4.944-10.018-4.944 10.018-11.056 1.607 8 7.798-1.889 11.011 9.889-5.199 9.889 5.199-1.889-11.011 8-7.798z">
      </path>
    </svg></div></div><div class="l-window-mask" style="display: none; height: 592px;"></div></body></html>